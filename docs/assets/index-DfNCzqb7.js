var A=Object.defineProperty;var W=(g,t,e)=>t in g?A(g,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):g[t]=e;var f=(g,t,e)=>W(g,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function e(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(i){if(i.ep)return;i.ep=!0;const s=e(i);fetch(i.href,s)}})();class b{constructor(t,e){f(this,"canvas");f(this,"ctx");this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=e;const o=this.canvas.getContext("2d");if(!o)throw new Error("Failed to get 2D context");this.ctx=o}static fromCanvas(t){const e=new b(t.width,t.height);e.canvas=t;const o=t.getContext("2d");if(!o)throw new Error("Failed to get 2D context");return e.ctx=o,e}static async fromImage(t){const e=new b(t.width,t.height);return e.ctx.drawImage(t,0,0),e}static async loadImage(t){return new Promise((e,o)=>{const i=new Image;i.onload=()=>e(i),i.onerror=o,i.src=t})}getCanvas(){return this.canvas}getContext(){return this.ctx}getWidth(){return this.canvas.width}getHeight(){return this.canvas.height}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}fill(t){this.ctx.fillStyle=this.colorToString(t),this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}fillRect(t,e){this.ctx.fillStyle=this.colorToString(e),this.ctx.fillRect(t.x,t.y,t.width,t.height)}strokeRect(t,e,o){this.ctx.strokeStyle=this.colorToString(e),this.ctx.lineWidth=o,this.ctx.strokeRect(t.x+o/2,t.y+o/2,t.width-o,t.height-o)}drawLine(t,e,o,i,s,l){this.ctx.strokeStyle=this.colorToString(s),this.ctx.lineWidth=l,this.ctx.beginPath(),this.ctx.moveTo(t,e),this.ctx.lineTo(o,i),this.ctx.stroke()}drawImage(t,e,o,i,s,l,a,d,h){const r=t instanceof b?t.getCanvas():t;this.ctx.drawImage(r,e,o,i,s,l,a,d,h)}getImageData(t){return t?this.ctx.getImageData(t.x,t.y,t.width,t.height):this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height)}putImageData(t,e,o){this.ctx.putImageData(t,e,o)}getPixel(t,e){const o=this.ctx.getImageData(t,e,1,1).data;return{r:o[0],g:o[1],b:o[2],a:o[3]}}setPixel(t,e,o){const i=this.ctx.createImageData(1,1);i.data[0]=o.r,i.data[1]=o.g,i.data[2]=o.b,i.data[3]=o.a,this.ctx.putImageData(i,t,e)}detectContentBounds(t,e=10){const i=this.getImageData(t).data,s=t.width,l=t.height;let a=s,d=l,h=0,r=0,n=!1;for(let c=0;c<l;c++)for(let u=0;u<s;u++){const C=(c*s+u)*4;i[C+3]>e&&(n=!0,u<a&&(a=u),c<d&&(d=c),u>h&&(h=u),c>r&&(r=c))}return n?{minX:a,minY:d,maxX:h,maxY:r}:null}drawResized(t,e,o){this.ctx.drawImage(t.getCanvas(),e.x,e.y,e.width,e.height,o.x,o.y,o.width,o.height)}toDataURL(t="image/png"){return this.canvas.toDataURL(t)}toBlob(t="image/png"){return new Promise((e,o)=>{this.canvas.toBlob(i=>{i?e(i):o(new Error("Failed to create blob"))},t)})}downloadAsFile(t){const e=document.createElement("a");e.download=t,e.href=this.toDataURL(),e.click()}clone(){const t=new b(this.canvas.width,this.canvas.height);return t.ctx.drawImage(this.canvas,0,0),t}resize(t,e){const o=new b(t,e);return o.ctx.drawImage(this.canvas,0,0,t,e),o}colorToString(t){return`rgba(${t.r}, ${t.g}, ${t.b}, ${t.a/255})`}static hexToColor(t){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16),a:255}:{r:0,g:0,b:0,a:255}}static colorToHex(t){const e=o=>o.toString(16).padStart(2,"0");return`#${e(t.r)}${e(t.g)}${e(t.b)}`}}const k=[0,2,10,8,4,6,14,12,5,7,15,13,1,3,11,9];function D(){const g=[];for(let t=0;t<16;t++)g.push(k[t]);return g.push(79),g.push(143),g.push(47),g.push(31),g.push(63),g.push(207),g.push(159),g.push(111),g.push(95),g.push(175),g.push(191),g.push(127),g.push(223),g.push(239),g.push(255),g.push(70),g.push(35),g.push(39),g.push(71),g.push(103),g.push(140),g.push(25),g.push(29),g.push(141),g.push(157),g.push(142),g.push(78),g.push(206),g.push(27),g.push(43),g.push(59),g}const H=D();class F{constructor(t){f(this,"config");this.config=t}generate(){const{tileFormat:t,tileSize:e,padding:o,offset:i}=this.config;if(t==="platformer")return this.generatePlatformerTemplate();const s=t===16?k:H,l=t===16?4:8,a=t===16?4:6,d=i+l*(e+o),h=i+a*(e+o),r=new b(d,h);for(let n=0;n<s.length;n++){const c=n%l,u=Math.floor(n/l),C=i+c*(e+o),T=i+u*(e+o);this.drawTile(r,C,T,s[n])}return r}generatePlatformerTemplate(){const{tileSize:t,padding:e,offset:o,fillColor:i}=this.config,s=7,l=9,a=o+s*(t+e),d=o+l*(t+e),h=new b(a,d),r=h.getContext();r.fillStyle=this.colorToStyle(i),this.drawPlatformerTile(h,r,0,0,"slope_45_up"),this.drawPlatformerTile(h,r,1,0,"floor_45"),this.drawPlatformerTile(h,r,2,0,"slope_45_down");for(let n=0;n<3;n++)this.drawFilledSquare(r,n,1,t,e,o);this.drawPlatformerTile(h,r,0,2,"slope_45_ceiling_up"),this.drawPlatformerTile(h,r,1,2,"ceiling_45"),this.drawPlatformerTile(h,r,2,2,"slope_45_ceiling_down"),this.drawMultiTileSlope(r,0,3,t,e,o,2,0,!1,!1),this.drawMultiTileSlope(r,1,3,t,e,o,2,1,!1,!1),this.drawFloorAtFraction(r,2,3,t,e,o,1,!1),this.drawMultiTileSlope(r,3,3,t,e,o,2,1,!0,!1),this.drawMultiTileSlope(r,4,3,t,e,o,2,0,!0,!1);for(let n=0;n<5;n++)this.drawFilledSquare(r,n,4,t,e,o);this.drawMultiTileSlope(r,0,5,t,e,o,2,0,!1,!0),this.drawMultiTileSlope(r,1,5,t,e,o,2,1,!1,!0),this.drawFloorAtFraction(r,2,5,t,e,o,1,!0),this.drawMultiTileSlope(r,3,5,t,e,o,2,1,!0,!0),this.drawMultiTileSlope(r,4,5,t,e,o,2,0,!0,!0),this.drawMultiTileSlope(r,0,6,t,e,o,3,0,!1,!1),this.drawMultiTileSlope(r,1,6,t,e,o,3,1,!1,!1),this.drawMultiTileSlope(r,2,6,t,e,o,3,2,!1,!1),this.drawFloorAtFraction(r,3,6,t,e,o,1,!1),this.drawMultiTileSlope(r,4,6,t,e,o,3,2,!0,!1),this.drawMultiTileSlope(r,5,6,t,e,o,3,1,!0,!1),this.drawMultiTileSlope(r,6,6,t,e,o,3,0,!0,!1);for(let n=0;n<7;n++)this.drawFilledSquare(r,n,7,t,e,o);return this.drawMultiTileSlope(r,0,8,t,e,o,3,0,!1,!0),this.drawMultiTileSlope(r,1,8,t,e,o,3,1,!1,!0),this.drawMultiTileSlope(r,2,8,t,e,o,3,2,!1,!0),this.drawFloorAtFraction(r,3,8,t,e,o,1,!0),this.drawMultiTileSlope(r,4,8,t,e,o,3,2,!0,!0),this.drawMultiTileSlope(r,5,8,t,e,o,3,1,!0,!0),this.drawMultiTileSlope(r,6,8,t,e,o,3,0,!0,!0),h}drawFilledSquare(t,e,o,i,s,l){const a=l+e*(i+s),d=l+o*(i+s);t.fillRect(a,d,i,i)}drawMultiTileSlope(t,e,o,i,s,l,a,d,h,r){const n=l+e*(i+s),c=l+o*(i+s),u=d/a,C=(d+1)/a,T=i*u,m=i*C;t.beginPath(),r?h?(t.moveTo(n,c),t.lineTo(n+i,c),t.lineTo(n+i,c+T),t.lineTo(n,c+m)):(t.moveTo(n,c),t.lineTo(n+i,c),t.lineTo(n+i,c+m),t.lineTo(n,c+T)):h?(t.moveTo(n,c+i),t.lineTo(n+i,c+i),t.lineTo(n+i,c+i-T),t.lineTo(n,c+i-m)):(t.moveTo(n,c+i),t.lineTo(n+i,c+i),t.lineTo(n+i,c+i-m),t.lineTo(n,c+i-T)),t.closePath(),t.fill()}drawFloorAtFraction(t,e,o,i,s,l,a,d){const h=l+e*(i+s),r=l+o*(i+s),n=i*a;d?t.fillRect(h,r,i,n):t.fillRect(h,r+i-n,i,n)}drawPlatformerTile(t,e,o,i,s){const{tileSize:l,padding:a,offset:d,fillColor:h}=this.config,r=d+o*(l+a),n=d+i*(l+a);switch(e.fillStyle=this.colorToStyle(h),s){case"floor":e.fillRect(r,n+l/2,l,l/2);break;case"ceiling":e.fillRect(r,n,l,l/2);break;case"wall_left":e.fillRect(r,n,l/2,l);break;case"wall_right":e.fillRect(r+l/2,n,l/2,l);break;case"slope_45_up":this.drawSlopePolygon(e,r,n,l,45,!1,!1);break;case"floor_45":this.drawFloorAtHeight(e,r,n,l,45,!1);break;case"slope_45_down":this.drawSlopePolygon(e,r,n,l,45,!0,!1);break;case"slope_45_ceiling_up":this.drawSlopePolygon(e,r,n,l,45,!1,!0);break;case"ceiling_45":this.drawFloorAtHeight(e,r,n,l,45,!0);break;case"slope_45_ceiling_down":this.drawSlopePolygon(e,r,n,l,45,!0,!0);break;case"slope_30_up":this.drawSlopePolygon(e,r,n,l,30,!1,!1);break;case"floor_30":this.drawFloorAtHeight(e,r,n,l,30,!1);break;case"slope_30_down":this.drawSlopePolygon(e,r,n,l,30,!0,!1);break;case"slope_30_ceiling_up":this.drawSlopePolygon(e,r,n,l,30,!1,!0);break;case"ceiling_30":this.drawFloorAtHeight(e,r,n,l,30,!0);break;case"slope_30_ceiling_down":this.drawSlopePolygon(e,r,n,l,30,!0,!0);break;case"slope_15_up":this.drawSlopePolygon(e,r,n,l,15,!1,!1);break;case"floor_15":this.drawFloorAtHeight(e,r,n,l,15,!1);break;case"slope_15_down":this.drawSlopePolygon(e,r,n,l,15,!0,!1);break;case"slope_15_ceiling_up":this.drawSlopePolygon(e,r,n,l,15,!1,!0);break;case"ceiling_15":this.drawFloorAtHeight(e,r,n,l,15,!0);break;case"slope_15_ceiling_down":this.drawSlopePolygon(e,r,n,l,15,!0,!0);break}}drawFloorAtHeight(t,e,o,i,s,l){const a=i*Math.tan(s*Math.PI/180),d=Math.min(a,i);l?t.fillRect(e,o,i,d):t.fillRect(e,o+i-d,i,d)}drawSlopePolygon(t,e,o,i,s,l,a){const d=i*Math.tan(s*Math.PI/180),h=Math.min(d,i);t.beginPath(),a?l?(t.moveTo(e,o),t.lineTo(e,o+h),t.lineTo(e+i,o),t.lineTo(e,o)):(t.moveTo(e,o),t.lineTo(e+i,o),t.lineTo(e+i,o+h),t.lineTo(e,o)):l?(t.moveTo(e,o+i),t.lineTo(e,o+i-h),t.lineTo(e+i,o+i),t.lineTo(e,o+i)):(t.moveTo(e,o+i),t.lineTo(e+i,o+i),t.lineTo(e+i,o+i-h),t.lineTo(e,o+i)),t.closePath(),t.fill()}colorToStyle(t){return`rgba(${t.r}, ${t.g}, ${t.b}, ${t.a/255})`}getBorderColor(t){const{detailedColorMode:e,detailedColors:o,borderColor:i}=this.config;return e&&o?o[t]:i}drawTile(t,e,o,i){const{tileSize:s,fillColor:l,borderWidth:a}=this.config,d=t.getContext();t.fillRect({x:e,y:o,width:s,height:s},l),i&1||(d.fillStyle=this.colorToStyle(this.getBorderColor("top")),d.fillRect(e,o,s,a)),i&2||(d.fillStyle=this.colorToStyle(this.getBorderColor("right")),d.fillRect(e+s-a,o,a,s)),i&4||(d.fillStyle=this.colorToStyle(this.getBorderColor("bottom")),d.fillRect(e,o+s-a,s,a)),i&8||(d.fillStyle=this.colorToStyle(this.getBorderColor("left")),d.fillRect(e,o,a,s));const h=this.getBorderColor("corner");d.fillStyle=this.colorToStyle(h),!(i&1)&&!(i&8)&&d.fillRect(e,o,a,a),!(i&1)&&!(i&2)&&d.fillRect(e+s-a,o,a,a),!(i&4)&&!(i&2)&&d.fillRect(e+s-a,o+s-a,a,a),!(i&4)&&!(i&8)&&d.fillRect(e,o+s-a,a,a),this.config.tileFormat===47&&(i&1&&i&8&&!(i&16)&&d.fillRect(e,o,a,a),i&1&&i&2&&!(i&32)&&d.fillRect(e+s-a,o,a,a),i&4&&i&2&&!(i&64)&&d.fillRect(e+s-a,o+s-a,a,a),i&4&&i&8&&!(i&128)&&d.fillRect(e,o+s-a,a,a))}static drawGrid(t,e){const{tileFormat:o,tileSize:i,padding:s,offset:l}=e,a=o===16?4:8,d=o===16?4:6,h={r:128,g:128,b:128,a:180},r=t.getWidth(),n=t.getHeight();for(let c=0;c<=a;c++){const u=l+c*(i+s);u>=0&&u<=r&&t.drawLine(u,0,u,n,h,1)}for(let c=0;c<=d;c++){const u=l+c*(i+s);u>=0&&u<=n&&t.drawLine(0,u,r,u,h,1)}}static getDimensions(t){const{tileFormat:e,tileSize:o,padding:i,offset:s}=t;let l,a;e==="platformer"?(l=7,a=9):(l=e===16?4:8,a=e===16?4:6);const d=s+l*(o+i),h=s+a*(o+i);return{width:d,height:h,cols:l,rows:a}}}class G{constructor(t){f(this,"config");this.config=t}adjust(t){const{tileSize:e,padding:o,offset:i}=this.config,s=F.getDimensions(this.config),l=new b(s.width,s.height),a=[],d=s.cols,h=s.cols*s.rows;for(let r=0;r<h;r++){const n=r%d,c=Math.floor(r/d),u=i+n*(e+o),C=i+c*(e+o),T={x:u,y:C,width:e,height:e},m=this.estimateSourceTileRect(t,r,d,h),I=t.detectContentBounds(m);let P;if(I){const w={x:m.x+I.minX,y:m.y+I.minY,width:I.maxX-I.minX+1,height:I.maxY-I.minY+1},v=e/w.width,S=e/w.height,p=Math.min(v,S),y=w.width*p,_=w.height*p,B=(e-y)/2,E=(e-_)/2;l.drawImage(t.getCanvas(),w.x,w.y,w.width,w.height,u+B,C+E,y,_),P={index:r,original:m,detected:w,adjusted:{x:u+B,y:C+E,width:y,height:_},scale:{x:p,y:p},offset:{x:B,y:E}}}else l.drawImage(t.getCanvas(),m.x,m.y,m.width,m.height,u,C,e,e),P={index:r,original:m,detected:null,adjusted:T,scale:{x:1,y:1},offset:{x:0,y:0}};a.push(P)}return{processor:l,adjustments:a}}estimateSourceTileRect(t,e,o,i){const{tileSize:s,padding:l,offset:a}=this.config,d=F.getDimensions(this.config),h=e%o,r=Math.floor(e/o),n=t.getWidth(),c=t.getHeight(),u=d.width,C=d.height,T=n/u,m=c/C,I=Math.round((a+h*(s+l))*T),P=Math.round((a+r*(s+l))*m),w=Math.round(s*T),v=Math.round(s*m),S=Math.max(0,Math.min(I,n-1)),p=Math.max(0,Math.min(P,c-1)),y=Math.max(1,Math.min(w,n-S)),_=Math.max(1,Math.min(v,c-p));return{x:S,y:p,width:y,height:_}}adjustWithContentDetection(t){const{tileSize:e,padding:o,offset:i}=this.config,s=F.getDimensions(this.config),l=new b(s.width,s.height),a=[],d=s.cols,h=s.cols*s.rows,r=[];for(let u=0;u<h;u++){const C=this.estimateSourceTileRect(t,u,d,h),T=t.detectContentBounds(C);T&&r.push({width:T.maxX-T.minX+1,height:T.maxY-T.minY+1})}let n=e,c=e;r.length>0&&(n=r.reduce((u,C)=>u+C.width,0)/r.length,c=r.reduce((u,C)=>u+C.height,0)/r.length);for(let u=0;u<h;u++){const C=u%d,T=Math.floor(u/d),m=i+C*(e+o),I=i+T*(e+o),P={x:m,y:I,width:e,height:e},w=this.estimateSourceTileRect(t,u,d,h),v=t.detectContentBounds(w);let S;if(v){const p={x:w.x+v.minX,y:w.y+v.minY,width:v.maxX-v.minX+1,height:v.maxY-v.minY+1},y=Math.min(e/n,e/c),_=p.width*y,B=p.height*y,E=Math.min(_,e),L=Math.min(B,e),M=Math.min(E/p.width,L/p.height),R=(e-p.width*M)/2,j=(e-p.height*M)/2;l.drawImage(t.getCanvas(),p.x,p.y,p.width,p.height,m+R,I+j,p.width*M,p.height*M),S={index:u,original:w,detected:p,adjusted:{x:m+R,y:I+j,width:p.width*M,height:p.height*M},scale:{x:M,y:M},offset:{x:R,y:j}}}else l.drawImage(t.getCanvas(),w.x,w.y,w.width,w.height,m,I,e,e),S={index:u,original:w,detected:null,adjusted:P,scale:{x:1,y:1},offset:{x:0,y:0}};a.push(S)}return{processor:l,adjustments:a}}}class x{constructor(){f(this,"tileFormatSelect");f(this,"tileSizeInput");f(this,"tilePaddingInput");f(this,"tileOffsetInput");f(this,"fillColorInput");f(this,"borderColorInput");f(this,"borderWidthInput");f(this,"detailedColorModeCheckbox");f(this,"detailedColorSettings");f(this,"detailedColorModeGroup");f(this,"borderColorGroup");f(this,"borderWidthGroup");f(this,"borderColorTopInput");f(this,"borderColorBottomInput");f(this,"borderColorLeftInput");f(this,"borderColorRightInput");f(this,"borderColorCornerInput");f(this,"saveTemplateBtn");f(this,"spriteInput");f(this,"autoAdjustBtn");f(this,"saveAdjustedBtn");f(this,"templateCanvas");f(this,"originalCanvas");f(this,"adjustedCanvas");f(this,"templateProcessor",null);f(this,"originalProcessor",null);f(this,"adjustedProcessor",null);this.initElements(),this.bindEvents(),this.generateTemplate()}initElements(){this.tileFormatSelect=document.getElementById("tileFormat"),this.tileSizeInput=document.getElementById("tileSize"),this.tilePaddingInput=document.getElementById("tilePadding"),this.tileOffsetInput=document.getElementById("tileOffset"),this.fillColorInput=document.getElementById("fillColor"),this.borderColorInput=document.getElementById("borderColor"),this.borderWidthInput=document.getElementById("borderWidth"),this.detailedColorModeCheckbox=document.getElementById("detailedColorMode"),this.detailedColorSettings=document.getElementById("detailedColorSettings"),this.detailedColorModeGroup=document.getElementById("detailedColorModeGroup"),this.borderColorGroup=document.getElementById("borderColorGroup"),this.borderWidthGroup=document.getElementById("borderWidthGroup"),this.borderColorTopInput=document.getElementById("borderColorTop"),this.borderColorBottomInput=document.getElementById("borderColorBottom"),this.borderColorLeftInput=document.getElementById("borderColorLeft"),this.borderColorRightInput=document.getElementById("borderColorRight"),this.borderColorCornerInput=document.getElementById("borderColorCorner"),this.saveTemplateBtn=document.getElementById("saveTemplateBtn"),this.spriteInput=document.getElementById("spriteInput"),this.autoAdjustBtn=document.getElementById("autoAdjustBtn"),this.saveAdjustedBtn=document.getElementById("saveAdjustedBtn"),this.templateCanvas=document.getElementById("templateCanvas"),this.originalCanvas=document.getElementById("originalCanvas"),this.adjustedCanvas=document.getElementById("adjustedCanvas")}bindEvents(){this.saveTemplateBtn.addEventListener("click",()=>this.saveTemplate()),this.spriteInput.addEventListener("change",e=>this.loadSprite(e)),this.autoAdjustBtn.addEventListener("click",()=>this.autoAdjust()),this.saveAdjustedBtn.addEventListener("click",()=>this.saveAdjusted()),this.detailedColorModeCheckbox.addEventListener("change",()=>{this.toggleDetailedColorSettings(),this.generateTemplate()}),this.tileFormatSelect.addEventListener("change",()=>{this.updateUIForTemplateType()}),this.updateUIForTemplateType(),[this.tileFormatSelect,this.tileSizeInput,this.tilePaddingInput,this.tileOffsetInput,this.fillColorInput,this.borderColorInput,this.borderWidthInput,this.borderColorTopInput,this.borderColorBottomInput,this.borderColorLeftInput,this.borderColorRightInput,this.borderColorCornerInput].forEach(e=>{e.addEventListener("change",()=>this.generateTemplate())})}toggleDetailedColorSettings(){this.detailedColorModeCheckbox.checked?(this.detailedColorSettings.classList.remove("hidden"),this.borderColorGroup.classList.add("hidden")):(this.detailedColorSettings.classList.add("hidden"),this.borderColorGroup.classList.remove("hidden"))}updateUIForTemplateType(){this.tileFormatSelect.value==="platformer"?(this.borderColorGroup.classList.add("hidden"),this.borderWidthGroup.classList.add("hidden"),this.detailedColorModeGroup.classList.add("hidden"),this.detailedColorSettings.classList.add("hidden")):(this.borderWidthGroup.classList.remove("hidden"),this.detailedColorModeGroup.classList.remove("hidden"),this.toggleDetailedColorSettings())}getConfig(){const t=parseInt(this.tileSizeInput.value)||64,e=parseInt(this.borderWidthInput.value)||10,o=this.detailedColorModeCheckbox.checked,i=this.tileFormatSelect.value;let s;i==="platformer"?s="platformer":s=parseInt(i);const l={tileFormat:s,tileSize:t,padding:parseInt(this.tilePaddingInput.value)||0,offset:parseInt(this.tileOffsetInput.value)||0,fillColor:b.hexToColor(this.fillColorInput.value),borderColor:b.hexToColor(this.borderColorInput.value),borderWidth:Math.min(e,Math.floor(t/2)),detailedColorMode:o};return o&&(l.detailedColors={top:b.hexToColor(this.borderColorTopInput.value),bottom:b.hexToColor(this.borderColorBottomInput.value),left:b.hexToColor(this.borderColorLeftInput.value),right:b.hexToColor(this.borderColorRightInput.value),corner:b.hexToColor(this.borderColorCornerInput.value)}),l}generateTemplate(){const t=this.getConfig(),e=new F(t);this.templateProcessor=e.generate(),this.renderPreviewWithBackground(this.templateProcessor,this.templateCanvas,t)}saveTemplate(){if(!this.templateProcessor){alert("テンプレートを生成してください");return}const t=this.tileFormatSelect.value,e=t==="platformer"?"sprite_template_platformer.png":`sprite_template_${t}tiles.png`;this.templateProcessor.downloadAsFile(e)}async loadSprite(t){var i;const o=(i=t.target.files)==null?void 0:i[0];if(o)try{const s=URL.createObjectURL(o),l=await b.loadImage(s);this.originalProcessor=await b.fromImage(l),URL.revokeObjectURL(s);const a=this.getConfig();this.renderPreviewWithBackground(this.originalProcessor,this.originalCanvas,a),this.adjustedProcessor=null,this.clearCanvas(this.adjustedCanvas)}catch(s){console.error("Failed to load image:",s),alert("画像の読み込みに失敗しました")}}autoAdjust(){if(!this.originalProcessor){alert("スプライトシート画像を読み込んでください");return}const t=this.getConfig(),o=new G(t).adjustWithContentDetection(this.originalProcessor);this.adjustedProcessor=o.processor,this.renderPreviewWithBackground(this.adjustedProcessor,this.adjustedCanvas,t),console.log("Adjustments:",o.adjustments)}saveAdjusted(){if(!this.adjustedProcessor){alert("自動調整を実行してください");return}const t=this.tileFormatSelect.value,e=t==="platformer"?"sprite_adjusted_platformer.png":`sprite_adjusted_${t}tiles.png`;this.adjustedProcessor.downloadAsFile(e)}renderPreviewWithBackground(t,e,o){const i=F.getDimensions(o),s=t.getWidth(),l=t.getHeight(),a=Math.max(i.width,s),d=Math.max(i.height,l);e.width=a,e.height=d;const h=e.getContext("2d");h&&(h.fillStyle="#3a3a3a",h.fillRect(0,0,a,d),h.drawImage(t.getCanvas(),0,0),this.drawGridOnCanvas(h,o,s,l))}drawGridOnCanvas(t,e,o,i){const{tileFormat:s,tileSize:l,padding:a,offset:d}=e;let h,r;s==="platformer"?(h=7,r=9):(h=s===16?4:8,r=s===16?4:6),t.strokeStyle="rgba(128, 128, 128, 0.7)",t.lineWidth=1;for(let n=0;n<=h;n++){const c=d+n*(l+a);c>=0&&c<=o&&(t.beginPath(),t.moveTo(c+.5,0),t.lineTo(c+.5,i),t.stroke())}for(let n=0;n<=r;n++){const c=d+n*(l+a);c>=0&&c<=i&&(t.beginPath(),t.moveTo(0,c+.5),t.lineTo(o,c+.5),t.stroke())}}clearCanvas(t){const e=t.getContext("2d");e&&e.clearRect(0,0,t.width,t.height)}}document.addEventListener("DOMContentLoaded",()=>{new x});
