var W=Object.defineProperty;var D=(u,t,e)=>t in u?W(u,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):u[t]=e;var g=(u,t,e)=>D(u,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const s of l.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function e(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(i){if(i.ep)return;i.ep=!0;const l=e(i);fetch(i.href,l)}})();class T{constructor(t,e){g(this,"canvas");g(this,"ctx");this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=e;const o=this.canvas.getContext("2d");if(!o)throw new Error("Failed to get 2D context");this.ctx=o}static fromCanvas(t){const e=new T(t.width,t.height);e.canvas=t;const o=t.getContext("2d");if(!o)throw new Error("Failed to get 2D context");return e.ctx=o,e}static async fromImage(t){const e=new T(t.width,t.height);return e.ctx.drawImage(t,0,0),e}static async loadImage(t){return new Promise((e,o)=>{const i=new Image;i.onload=()=>e(i),i.onerror=o,i.src=t})}getCanvas(){return this.canvas}getContext(){return this.ctx}getWidth(){return this.canvas.width}getHeight(){return this.canvas.height}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}fill(t){this.ctx.fillStyle=this.colorToString(t),this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}fillRect(t,e){this.ctx.fillStyle=this.colorToString(e),this.ctx.fillRect(t.x,t.y,t.width,t.height)}strokeRect(t,e,o){this.ctx.strokeStyle=this.colorToString(e),this.ctx.lineWidth=o,this.ctx.strokeRect(t.x+o/2,t.y+o/2,t.width-o,t.height-o)}drawLine(t,e,o,i,l,s){this.ctx.strokeStyle=this.colorToString(l),this.ctx.lineWidth=s,this.ctx.beginPath(),this.ctx.moveTo(t,e),this.ctx.lineTo(o,i),this.ctx.stroke()}drawImage(t,e,o,i,l,s,a,d,h){const r=t instanceof T?t.getCanvas():t;this.ctx.drawImage(r,e,o,i,l,s,a,d,h)}getImageData(t){return t?this.ctx.getImageData(t.x,t.y,t.width,t.height):this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height)}putImageData(t,e,o){this.ctx.putImageData(t,e,o)}getPixel(t,e){const o=this.ctx.getImageData(t,e,1,1).data;return{r:o[0],g:o[1],b:o[2],a:o[3]}}setPixel(t,e,o){const i=this.ctx.createImageData(1,1);i.data[0]=o.r,i.data[1]=o.g,i.data[2]=o.b,i.data[3]=o.a,this.ctx.putImageData(i,t,e)}detectContentBounds(t,e=10){const i=this.getImageData(t).data,l=t.width,s=t.height;let a=l,d=s,h=0,r=0,n=!1;for(let c=0;c<s;c++)for(let f=0;f<l;f++){const p=(c*l+f)*4;i[p+3]>e&&(n=!0,f<a&&(a=f),c<d&&(d=c),f>h&&(h=f),c>r&&(r=c))}return n?{minX:a,minY:d,maxX:h,maxY:r}:null}drawResized(t,e,o){this.ctx.drawImage(t.getCanvas(),e.x,e.y,e.width,e.height,o.x,o.y,o.width,o.height)}toDataURL(t="image/png"){return this.canvas.toDataURL(t)}toBlob(t="image/png"){return new Promise((e,o)=>{this.canvas.toBlob(i=>{i?e(i):o(new Error("Failed to create blob"))},t)})}downloadAsFile(t){const e=document.createElement("a");e.download=t,e.href=this.toDataURL(),e.click()}clone(){const t=new T(this.canvas.width,this.canvas.height);return t.ctx.drawImage(this.canvas,0,0),t}resize(t,e){const o=new T(t,e);return o.ctx.drawImage(this.canvas,0,0,t,e),o}colorToString(t){return`rgba(${t.r}, ${t.g}, ${t.b}, ${t.a/255})`}static hexToColor(t){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16),a:255}:{r:0,g:0,b:0,a:255}}static colorToHex(t){const e=o=>o.toString(16).padStart(2,"0");return`#${e(t.r)}${e(t.g)}${e(t.b)}`}}const L=[0,2,10,8,4,6,14,12,5,7,15,13,1,3,11,9];function H(){const u=[];for(let t=0;t<16;t++)u.push(L[t]);return u.push(79),u.push(143),u.push(47),u.push(31),u.push(63),u.push(207),u.push(159),u.push(111),u.push(95),u.push(175),u.push(191),u.push(127),u.push(223),u.push(239),u.push(255),u.push(70),u.push(35),u.push(39),u.push(71),u.push(103),u.push(140),u.push(25),u.push(29),u.push(141),u.push(157),u.push(142),u.push(78),u.push(206),u.push(27),u.push(43),u.push(59),u}const G=H();class j{constructor(t){g(this,"config");this.config=t}generate(){const{tileFormat:t,tileSize:e,padding:o,offset:i}=this.config;if(t==="platformer")return this.generatePlatformerTemplate();const l=t===16?L:G,s=t===16?4:8,a=t===16?4:6,d=i+s*(e+o),h=i+a*(e+o),r=new T(d,h);for(let n=0;n<l.length;n++){const c=n%s,f=Math.floor(n/s),p=i+c*(e+o),m=i+f*(e+o);this.drawTile(r,p,m,l[n])}return r}generatePlatformerTemplate(){const{tileSize:t,padding:e,offset:o,fillColor:i}=this.config,l=7,s=7,a=o+l*(t+e),d=o+s*(t+e),h=new T(a,d),r=h.getContext();return r.fillStyle=this.colorToStyle(i),this.drawPlatformerTile(h,r,0,0,"floor"),this.drawPlatformerTile(h,r,1,0,"ceiling"),this.drawPlatformerTile(h,r,2,0,"wall_left"),this.drawPlatformerTile(h,r,3,0,"wall_right"),this.drawPlatformerTile(h,r,0,1,"slope_45_up"),this.drawPlatformerTile(h,r,1,1,"floor_45"),this.drawPlatformerTile(h,r,2,1,"slope_45_down"),this.drawPlatformerTile(h,r,0,2,"slope_45_ceiling_up"),this.drawPlatformerTile(h,r,1,2,"ceiling_45"),this.drawPlatformerTile(h,r,2,2,"slope_45_ceiling_down"),this.drawMultiTileSlope(r,0,3,t,e,o,2,0,!1,!1),this.drawMultiTileSlope(r,1,3,t,e,o,2,1,!1,!1),this.drawFloorAtFraction(r,2,3,t,e,o,1,!1),this.drawMultiTileSlope(r,3,3,t,e,o,2,1,!0,!1),this.drawMultiTileSlope(r,4,3,t,e,o,2,0,!0,!1),this.drawMultiTileSlope(r,0,4,t,e,o,2,0,!1,!0),this.drawMultiTileSlope(r,1,4,t,e,o,2,1,!1,!0),this.drawFloorAtFraction(r,2,4,t,e,o,1,!0),this.drawMultiTileSlope(r,3,4,t,e,o,2,1,!0,!0),this.drawMultiTileSlope(r,4,4,t,e,o,2,0,!0,!0),this.drawMultiTileSlope(r,0,5,t,e,o,3,0,!1,!1),this.drawMultiTileSlope(r,1,5,t,e,o,3,1,!1,!1),this.drawMultiTileSlope(r,2,5,t,e,o,3,2,!1,!1),this.drawFloorAtFraction(r,3,5,t,e,o,1,!1),this.drawMultiTileSlope(r,4,5,t,e,o,3,2,!0,!1),this.drawMultiTileSlope(r,5,5,t,e,o,3,1,!0,!1),this.drawMultiTileSlope(r,6,5,t,e,o,3,0,!0,!1),this.drawMultiTileSlope(r,0,6,t,e,o,3,0,!1,!0),this.drawMultiTileSlope(r,1,6,t,e,o,3,1,!1,!0),this.drawMultiTileSlope(r,2,6,t,e,o,3,2,!1,!0),this.drawFloorAtFraction(r,3,6,t,e,o,1,!0),this.drawMultiTileSlope(r,4,6,t,e,o,3,2,!0,!0),this.drawMultiTileSlope(r,5,6,t,e,o,3,1,!0,!0),this.drawMultiTileSlope(r,6,6,t,e,o,3,0,!0,!0),h}drawMultiTileSlope(t,e,o,i,l,s,a,d,h,r){const n=s+e*(i+l),c=s+o*(i+l),f=d/a,p=(d+1)/a,m=i*f,b=i*p;t.beginPath(),r?h?(t.moveTo(n,c),t.lineTo(n+i,c),t.lineTo(n+i,c+m),t.lineTo(n,c+b)):(t.moveTo(n,c),t.lineTo(n+i,c),t.lineTo(n+i,c+b),t.lineTo(n,c+m)):h?(t.moveTo(n,c+i),t.lineTo(n+i,c+i),t.lineTo(n+i,c+i-m),t.lineTo(n,c+i-b)):(t.moveTo(n,c+i),t.lineTo(n+i,c+i),t.lineTo(n+i,c+i-b),t.lineTo(n,c+i-m)),t.closePath(),t.fill()}drawFloorAtFraction(t,e,o,i,l,s,a,d){const h=s+e*(i+l),r=s+o*(i+l),n=i*a;d?t.fillRect(h,r,i,n):t.fillRect(h,r+i-n,i,n)}drawPlatformerTile(t,e,o,i,l){const{tileSize:s,padding:a,offset:d,fillColor:h}=this.config,r=d+o*(s+a),n=d+i*(s+a);switch(e.fillStyle=this.colorToStyle(h),l){case"floor":e.fillRect(r,n+s/2,s,s/2);break;case"ceiling":e.fillRect(r,n,s,s/2);break;case"wall_left":e.fillRect(r,n,s/2,s);break;case"wall_right":e.fillRect(r+s/2,n,s/2,s);break;case"slope_45_up":this.drawSlopePolygon(e,r,n,s,45,!1,!1);break;case"floor_45":this.drawFloorAtHeight(e,r,n,s,45,!1);break;case"slope_45_down":this.drawSlopePolygon(e,r,n,s,45,!0,!1);break;case"slope_45_ceiling_up":this.drawSlopePolygon(e,r,n,s,45,!1,!0);break;case"ceiling_45":this.drawFloorAtHeight(e,r,n,s,45,!0);break;case"slope_45_ceiling_down":this.drawSlopePolygon(e,r,n,s,45,!0,!0);break;case"slope_30_up":this.drawSlopePolygon(e,r,n,s,30,!1,!1);break;case"floor_30":this.drawFloorAtHeight(e,r,n,s,30,!1);break;case"slope_30_down":this.drawSlopePolygon(e,r,n,s,30,!0,!1);break;case"slope_30_ceiling_up":this.drawSlopePolygon(e,r,n,s,30,!1,!0);break;case"ceiling_30":this.drawFloorAtHeight(e,r,n,s,30,!0);break;case"slope_30_ceiling_down":this.drawSlopePolygon(e,r,n,s,30,!0,!0);break;case"slope_15_up":this.drawSlopePolygon(e,r,n,s,15,!1,!1);break;case"floor_15":this.drawFloorAtHeight(e,r,n,s,15,!1);break;case"slope_15_down":this.drawSlopePolygon(e,r,n,s,15,!0,!1);break;case"slope_15_ceiling_up":this.drawSlopePolygon(e,r,n,s,15,!1,!0);break;case"ceiling_15":this.drawFloorAtHeight(e,r,n,s,15,!0);break;case"slope_15_ceiling_down":this.drawSlopePolygon(e,r,n,s,15,!0,!0);break}}drawFloorAtHeight(t,e,o,i,l,s){const a=i*Math.tan(l*Math.PI/180),d=Math.min(a,i);s?t.fillRect(e,o,i,d):t.fillRect(e,o+i-d,i,d)}drawSlopePolygon(t,e,o,i,l,s,a){const d=i*Math.tan(l*Math.PI/180),h=Math.min(d,i);t.beginPath(),a?s?(t.moveTo(e,o),t.lineTo(e,o+h),t.lineTo(e+i,o),t.lineTo(e,o)):(t.moveTo(e,o),t.lineTo(e+i,o),t.lineTo(e+i,o+h),t.lineTo(e,o)):s?(t.moveTo(e,o+i),t.lineTo(e,o+i-h),t.lineTo(e+i,o+i),t.lineTo(e,o+i)):(t.moveTo(e,o+i),t.lineTo(e+i,o+i),t.lineTo(e+i,o+i-h),t.lineTo(e,o+i)),t.closePath(),t.fill()}colorToStyle(t){return`rgba(${t.r}, ${t.g}, ${t.b}, ${t.a/255})`}getBorderColor(t){const{detailedColorMode:e,detailedColors:o,borderColor:i}=this.config;return e&&o?o[t]:i}drawTile(t,e,o,i){const{tileSize:l,fillColor:s,borderWidth:a}=this.config,d=t.getContext();t.fillRect({x:e,y:o,width:l,height:l},s),i&1||(d.fillStyle=this.colorToStyle(this.getBorderColor("top")),d.fillRect(e,o,l,a)),i&2||(d.fillStyle=this.colorToStyle(this.getBorderColor("right")),d.fillRect(e+l-a,o,a,l)),i&4||(d.fillStyle=this.colorToStyle(this.getBorderColor("bottom")),d.fillRect(e,o+l-a,l,a)),i&8||(d.fillStyle=this.colorToStyle(this.getBorderColor("left")),d.fillRect(e,o,a,l));const h=this.getBorderColor("corner");d.fillStyle=this.colorToStyle(h),!(i&1)&&!(i&8)&&d.fillRect(e,o,a,a),!(i&1)&&!(i&2)&&d.fillRect(e+l-a,o,a,a),!(i&4)&&!(i&2)&&d.fillRect(e+l-a,o+l-a,a,a),!(i&4)&&!(i&8)&&d.fillRect(e,o+l-a,a,a),this.config.tileFormat===47&&(i&1&&i&8&&!(i&16)&&d.fillRect(e,o,a,a),i&1&&i&2&&!(i&32)&&d.fillRect(e+l-a,o,a,a),i&4&&i&2&&!(i&64)&&d.fillRect(e+l-a,o+l-a,a,a),i&4&&i&8&&!(i&128)&&d.fillRect(e,o+l-a,a,a))}static drawGrid(t,e){const{tileFormat:o,tileSize:i,padding:l,offset:s}=e,a=o===16?4:8,d=o===16?4:6,h={r:128,g:128,b:128,a:180},r=t.getWidth(),n=t.getHeight();for(let c=0;c<=a;c++){const f=s+c*(i+l);f>=0&&f<=r&&t.drawLine(f,0,f,n,h,1)}for(let c=0;c<=d;c++){const f=s+c*(i+l);f>=0&&f<=n&&t.drawLine(0,f,r,f,h,1)}}static getDimensions(t){const{tileFormat:e,tileSize:o,padding:i,offset:l}=t;let s,a;e==="platformer"?(s=7,a=7):(s=e===16?4:8,a=e===16?4:6);const d=l+s*(o+i),h=l+a*(o+i);return{width:d,height:h,cols:s,rows:a}}}class x{constructor(t){g(this,"config");this.config=t}adjust(t){const{tileFormat:e,tileSize:o,padding:i,offset:l}=this.config,s=j.getDimensions(this.config),a=new T(s.width,s.height),d=[],h=e===16?16:47,r=s.cols;for(let n=0;n<h;n++){const c=n%r,f=Math.floor(n/r),p=l+c*(o+i),m=l+f*(o+i),b={x:p,y:m,width:o,height:o},I=this.estimateSourceTileRect(t,n,r,h),v=t.detectContentBounds(I);let y;if(v){const w={x:I.x+v.minX,y:I.y+v.minY,width:v.maxX-v.minX+1,height:v.maxY-v.minY+1},S=o/w.width,_=o/w.height,C=Math.min(S,_),P=w.width*C,B=w.height*C,E=(o-P)/2,R=(o-B)/2;a.drawImage(t.getCanvas(),w.x,w.y,w.width,w.height,p+E,m+R,P,B),y={index:n,original:I,detected:w,adjusted:{x:p+E,y:m+R,width:P,height:B},scale:{x:C,y:C},offset:{x:E,y:R}}}else a.drawImage(t.getCanvas(),I.x,I.y,I.width,I.height,p,m,o,o),y={index:n,original:I,detected:null,adjusted:b,scale:{x:1,y:1},offset:{x:0,y:0}};d.push(y)}return{processor:a,adjustments:d}}estimateSourceTileRect(t,e,o,i){const{tileSize:l,padding:s,offset:a}=this.config,d=e%o,h=Math.floor(e/o),r=t.getWidth(),n=t.getHeight(),c=a+o*(l+s),f=Math.ceil(i/o),p=a+f*(l+s),m=r/c,b=n/p,I=Math.round((a+d*(l+s))*m),v=Math.round((a+h*(l+s))*b),y=Math.round(l*m),w=Math.round(l*b);return{x:Math.max(0,Math.min(I,r-y)),y:Math.max(0,Math.min(v,n-w)),width:Math.min(y,r-I),height:Math.min(w,n-v)}}adjustWithContentDetection(t){const{tileFormat:e,tileSize:o,padding:i,offset:l}=this.config,s=j.getDimensions(this.config),a=new T(s.width,s.height),d=[],h=e===16?16:47,r=s.cols,n=[];for(let p=0;p<h;p++){const m=this.estimateSourceTileRect(t,p,r,h),b=t.detectContentBounds(m);b&&n.push({width:b.maxX-b.minX+1,height:b.maxY-b.minY+1})}let c=o,f=o;n.length>0&&(c=n.reduce((p,m)=>p+m.width,0)/n.length,f=n.reduce((p,m)=>p+m.height,0)/n.length);for(let p=0;p<h;p++){const m=p%r,b=Math.floor(p/r),I=l+m*(o+i),v=l+b*(o+i),y={x:I,y:v,width:o,height:o},w=this.estimateSourceTileRect(t,p,r,h),S=t.detectContentBounds(w);let _;if(S){const C={x:w.x+S.minX,y:w.y+S.minY,width:S.maxX-S.minX+1,height:S.maxY-S.minY+1},P=Math.min(o/c,o/f),B=C.width*P,E=C.height*P,R=Math.min(B,o),A=Math.min(E,o),M=Math.min(R/C.width,A/C.height),F=(o-C.width*M)/2,k=(o-C.height*M)/2;a.drawImage(t.getCanvas(),C.x,C.y,C.width,C.height,I+F,v+k,C.width*M,C.height*M),_={index:p,original:w,detected:C,adjusted:{x:I+F,y:v+k,width:C.width*M,height:C.height*M},scale:{x:M,y:M},offset:{x:F,y:k}}}else a.drawImage(t.getCanvas(),w.x,w.y,w.width,w.height,I,v,o,o),_={index:p,original:w,detected:null,adjusted:y,scale:{x:1,y:1},offset:{x:0,y:0}};d.push(_)}return{processor:a,adjustments:d}}}class O{constructor(){g(this,"tileFormatSelect");g(this,"tileSizeInput");g(this,"tilePaddingInput");g(this,"tileOffsetInput");g(this,"fillColorInput");g(this,"borderColorInput");g(this,"borderWidthInput");g(this,"detailedColorModeCheckbox");g(this,"detailedColorSettings");g(this,"detailedColorModeGroup");g(this,"borderColorGroup");g(this,"borderWidthGroup");g(this,"borderColorTopInput");g(this,"borderColorBottomInput");g(this,"borderColorLeftInput");g(this,"borderColorRightInput");g(this,"borderColorCornerInput");g(this,"saveTemplateBtn");g(this,"spriteInput");g(this,"autoAdjustBtn");g(this,"saveAdjustedBtn");g(this,"templateCanvas");g(this,"originalCanvas");g(this,"adjustedCanvas");g(this,"templateProcessor",null);g(this,"originalProcessor",null);g(this,"adjustedProcessor",null);this.initElements(),this.bindEvents(),this.generateTemplate()}initElements(){this.tileFormatSelect=document.getElementById("tileFormat"),this.tileSizeInput=document.getElementById("tileSize"),this.tilePaddingInput=document.getElementById("tilePadding"),this.tileOffsetInput=document.getElementById("tileOffset"),this.fillColorInput=document.getElementById("fillColor"),this.borderColorInput=document.getElementById("borderColor"),this.borderWidthInput=document.getElementById("borderWidth"),this.detailedColorModeCheckbox=document.getElementById("detailedColorMode"),this.detailedColorSettings=document.getElementById("detailedColorSettings"),this.detailedColorModeGroup=document.getElementById("detailedColorModeGroup"),this.borderColorGroup=document.getElementById("borderColorGroup"),this.borderWidthGroup=document.getElementById("borderWidthGroup"),this.borderColorTopInput=document.getElementById("borderColorTop"),this.borderColorBottomInput=document.getElementById("borderColorBottom"),this.borderColorLeftInput=document.getElementById("borderColorLeft"),this.borderColorRightInput=document.getElementById("borderColorRight"),this.borderColorCornerInput=document.getElementById("borderColorCorner"),this.saveTemplateBtn=document.getElementById("saveTemplateBtn"),this.spriteInput=document.getElementById("spriteInput"),this.autoAdjustBtn=document.getElementById("autoAdjustBtn"),this.saveAdjustedBtn=document.getElementById("saveAdjustedBtn"),this.templateCanvas=document.getElementById("templateCanvas"),this.originalCanvas=document.getElementById("originalCanvas"),this.adjustedCanvas=document.getElementById("adjustedCanvas")}bindEvents(){this.saveTemplateBtn.addEventListener("click",()=>this.saveTemplate()),this.spriteInput.addEventListener("change",e=>this.loadSprite(e)),this.autoAdjustBtn.addEventListener("click",()=>this.autoAdjust()),this.saveAdjustedBtn.addEventListener("click",()=>this.saveAdjusted()),this.detailedColorModeCheckbox.addEventListener("change",()=>{this.toggleDetailedColorSettings(),this.generateTemplate()}),this.tileFormatSelect.addEventListener("change",()=>{this.updateUIForTemplateType()}),this.updateUIForTemplateType(),[this.tileFormatSelect,this.tileSizeInput,this.tilePaddingInput,this.tileOffsetInput,this.fillColorInput,this.borderColorInput,this.borderWidthInput,this.borderColorTopInput,this.borderColorBottomInput,this.borderColorLeftInput,this.borderColorRightInput,this.borderColorCornerInput].forEach(e=>{e.addEventListener("change",()=>this.generateTemplate())})}toggleDetailedColorSettings(){this.detailedColorModeCheckbox.checked?(this.detailedColorSettings.classList.remove("hidden"),this.borderColorGroup.classList.add("hidden")):(this.detailedColorSettings.classList.add("hidden"),this.borderColorGroup.classList.remove("hidden"))}updateUIForTemplateType(){this.tileFormatSelect.value==="platformer"?(this.borderColorGroup.classList.add("hidden"),this.borderWidthGroup.classList.add("hidden"),this.detailedColorModeGroup.classList.add("hidden"),this.detailedColorSettings.classList.add("hidden")):(this.borderWidthGroup.classList.remove("hidden"),this.detailedColorModeGroup.classList.remove("hidden"),this.toggleDetailedColorSettings())}getConfig(){const t=parseInt(this.tileSizeInput.value)||64,e=parseInt(this.borderWidthInput.value)||10,o=this.detailedColorModeCheckbox.checked,i=this.tileFormatSelect.value;let l;i==="platformer"?l="platformer":l=parseInt(i);const s={tileFormat:l,tileSize:t,padding:parseInt(this.tilePaddingInput.value)||0,offset:parseInt(this.tileOffsetInput.value)||0,fillColor:T.hexToColor(this.fillColorInput.value),borderColor:T.hexToColor(this.borderColorInput.value),borderWidth:Math.min(e,Math.floor(t/2)),detailedColorMode:o};return o&&(s.detailedColors={top:T.hexToColor(this.borderColorTopInput.value),bottom:T.hexToColor(this.borderColorBottomInput.value),left:T.hexToColor(this.borderColorLeftInput.value),right:T.hexToColor(this.borderColorRightInput.value),corner:T.hexToColor(this.borderColorCornerInput.value)}),s}generateTemplate(){const t=this.getConfig(),e=new j(t);this.templateProcessor=e.generate(),this.renderPreviewWithBackground(this.templateProcessor,this.templateCanvas,t)}saveTemplate(){if(!this.templateProcessor){alert("テンプレートを生成してください");return}const t=this.tileFormatSelect.value,e=t==="platformer"?"sprite_template_platformer.png":`sprite_template_${t}tiles.png`;this.templateProcessor.downloadAsFile(e)}async loadSprite(t){var i;const o=(i=t.target.files)==null?void 0:i[0];if(o)try{const l=URL.createObjectURL(o),s=await T.loadImage(l);this.originalProcessor=await T.fromImage(s),URL.revokeObjectURL(l);const a=this.getConfig();this.renderPreviewWithBackground(this.originalProcessor,this.originalCanvas,a),this.adjustedProcessor=null,this.clearCanvas(this.adjustedCanvas)}catch(l){console.error("Failed to load image:",l),alert("画像の読み込みに失敗しました")}}autoAdjust(){if(!this.originalProcessor){alert("スプライトシート画像を読み込んでください");return}const t=this.getConfig(),o=new x(t).adjustWithContentDetection(this.originalProcessor);this.adjustedProcessor=o.processor,this.renderPreviewWithBackground(this.adjustedProcessor,this.adjustedCanvas,t),console.log("Adjustments:",o.adjustments)}saveAdjusted(){if(!this.adjustedProcessor){alert("自動調整を実行してください");return}const t=this.tileFormatSelect.value,e=t==="platformer"?"sprite_adjusted_platformer.png":`sprite_adjusted_${t}tiles.png`;this.adjustedProcessor.downloadAsFile(e)}renderPreviewWithBackground(t,e,o){const i=j.getDimensions(o),l=t.getWidth(),s=t.getHeight(),a=Math.max(i.width,l),d=Math.max(i.height,s);e.width=a,e.height=d;const h=e.getContext("2d");h&&(h.fillStyle="#3a3a3a",h.fillRect(0,0,a,d),h.drawImage(t.getCanvas(),0,0),this.drawGridOnCanvas(h,o,l,s))}drawGridOnCanvas(t,e,o,i){const{tileFormat:l,tileSize:s,padding:a,offset:d}=e,h=l===16?4:8,r=l===16?4:6;t.strokeStyle="rgba(128, 128, 128, 0.7)",t.lineWidth=1;for(let n=0;n<=h;n++){const c=d+n*(s+a);c>=0&&c<=o&&(t.beginPath(),t.moveTo(c+.5,0),t.lineTo(c+.5,i),t.stroke())}for(let n=0;n<=r;n++){const c=d+n*(s+a);c>=0&&c<=i&&(t.beginPath(),t.moveTo(0,c+.5),t.lineTo(o,c+.5),t.stroke())}}clearCanvas(t){const e=t.getContext("2d");e&&e.clearRect(0,0,t.width,t.height)}}document.addEventListener("DOMContentLoaded",()=>{new O});
